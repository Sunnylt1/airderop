{"ast":null,"code":"import { BaseMessageSignerWalletAdapter, scopePollingDetectionStrategy, WalletAccountError, WalletConnectionError, WalletDisconnectionError, WalletError, WalletNotConnectedError, WalletNotReadyError, WalletPublicKeyError, WalletReadyState, WalletSignMessageError, WalletSignTransactionError } from '@solana/wallet-adapter-base';\nimport { PublicKey } from '@solana/web3.js';\nimport bs58 from 'bs58';\nexport const SlopeWalletName = 'Slope';\nexport class SlopeWalletAdapter extends BaseMessageSignerWalletAdapter {\n  constructor() {\n    let config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super();\n    this.name = SlopeWalletName;\n    this.url = 'https://slope.finance';\n    this.icon = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiByeD0iNjQiIGZpbGw9IiM2RTY2RkEiLz4KPHBhdGggZD0iTTI3Ljk0NzUgNTIuMTU5Nkw1MS45ODI2IDI4LjA1NzJMNzIuNjA5OCA3LjY1Mzg5QzczLjg3MzQgNi40MDQwMSA3Ni4wMTc4IDcuMjk5MSA3Ni4wMTc4IDkuMDc2NDJMNzYuMDE4NyA1Mi4xNTlMNTEuOTgzNiA3Ni4xMjY4TDI3Ljk0NzUgNTIuMTU5NloiIGZpbGw9InVybCgjcGFpbnQwX2xpbmVhcl8zNzk1XzI1NTQzKSIvPgo8cGF0aCBkPSJNMTAwLjA1MyA3NS45OTNMNzYuMDE4IDUxLjk1OEw1MS45ODI5IDc1Ljk5MzFMNTEuOTgyOSAxMTguOTI0QzUxLjk4MjkgMTIwLjcwMyA1NC4xMzEyIDEyMS41OTcgNTUuMzkzNyAxMjAuMzQzTDEwMC4wNTMgNzUuOTkzWiIgZmlsbD0idXJsKCNwYWludDFfbGluZWFyXzM3OTVfMjU1NDMpIi8+CjxwYXRoIGQ9Ik0yNy45NDcgNTIuMTYwMUg0NC42ODM5QzQ4LjcxNDcgNTIuMTYwMSA1MS45ODIyIDU1LjQyNzYgNTEuOTgyMiA1OS40NTgzVjc2LjEyNjlIMzUuMjQ1M0MzMS4yMTQ2IDc2LjEyNjkgMjcuOTQ3IDcyLjg1OTQgMjcuOTQ3IDY4LjgyODdWNTIuMTYwMVoiIGZpbGw9IiNGMUYwRkYiLz4KPHBhdGggZD0iTTc2LjAxNzggNTIuMTYwMUg5Mi43NTQ3Qzk2Ljc4NTUgNTIuMTYwMSAxMDAuMDUzIDU1LjQyNzYgMTAwLjA1MyA1OS40NTgzVjc2LjEyNjlIODMuMzE2MUM3OS4yODU0IDc2LjEyNjkgNzYuMDE3OCA3Mi44NTk0IDc2LjAxNzggNjguODI4N1Y1Mi4xNjAxWiIgZmlsbD0iI0YxRjBGRiIvPgo8ZGVmcz4KPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDBfbGluZWFyXzM3OTVfMjU1NDMiIHgxPSI1MS45ODMxIiB5MT0iNy4wNzE1NSIgeDI9IjUxLjk4MzEiIHkyPSI3Ni4xMjY4IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CjxzdG9wIHN0b3AtY29sb3I9IiNBOEFERkYiLz4KPHN0b3Agb2Zmc2V0PSIwLjY0ODU1NiIgc3RvcC1jb2xvcj0id2hpdGUiLz4KPC9saW5lYXJHcmFkaWVudD4KPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDFfbGluZWFyXzM3OTVfMjU1NDMiIHgxPSI3Ni4wMTgiIHkxPSI1MS45NTgiIHgyPSI3Ni4wMTgiIHkyPSIxMjAuOTI4IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CjxzdG9wIG9mZnNldD0iMC4yNjA3ODQiIHN0b3AtY29sb3I9IiNCNkJBRkYiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjRTRFMkZGIi8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KPC9zdmc+Cg==';\n    this.supportedTransactionVersions = null;\n    this._readyState = typeof window === 'undefined' || typeof document === 'undefined' ? WalletReadyState.Unsupported : WalletReadyState.NotDetected;\n    this._connecting = false;\n    this._wallet = null;\n    this._publicKey = null;\n\n    if (this._readyState !== WalletReadyState.Unsupported) {\n      scopePollingDetectionStrategy(() => {\n        if (typeof window.Slope === 'function' || window.slopeApp) {\n          this._readyState = WalletReadyState.Installed;\n          this.emit('readyStateChange', this._readyState);\n          return true;\n        }\n\n        return false;\n      });\n    }\n  }\n\n  get publicKey() {\n    return this._publicKey;\n  }\n\n  get connecting() {\n    return this._connecting;\n  }\n\n  get readyState() {\n    return this._readyState;\n  }\n\n  async connect() {\n    try {\n      if (this.connected || this.connecting) return;\n      if (this._readyState !== WalletReadyState.Installed || typeof window.Slope !== 'function') throw new WalletNotReadyError();\n      this._connecting = true;\n      const wallet = new window.Slope();\n      let data;\n\n      try {\n        ({\n          data\n        } = await wallet.connect());\n      } catch (error) {\n        throw new WalletConnectionError(error?.message, error);\n      }\n\n      if (!data.publicKey) throw new WalletAccountError();\n      let publicKey;\n\n      try {\n        publicKey = new PublicKey(data.publicKey);\n      } catch (error) {\n        throw new WalletPublicKeyError(error?.message, error);\n      }\n\n      this._wallet = wallet;\n      this._publicKey = publicKey;\n      this.emit('connect', publicKey);\n    } catch (error) {\n      this.emit('error', error);\n      throw error;\n    } finally {\n      this._connecting = false;\n    }\n  }\n\n  async disconnect() {\n    const wallet = this._wallet;\n\n    if (wallet) {\n      this._wallet = null;\n      this._publicKey = null;\n\n      try {\n        let msg;\n\n        try {\n          ({\n            msg\n          } = await wallet.disconnect());\n        } catch (error) {\n          throw new WalletDisconnectionError(error?.message, error);\n        }\n\n        if (msg !== 'ok') throw new WalletDisconnectionError(msg);\n      } catch (error) {\n        this.emit('error', error);\n      }\n    }\n\n    this.emit('disconnect');\n  }\n\n  async signTransaction(transaction) {\n    try {\n      const wallet = this._wallet;\n      if (!wallet) throw new WalletNotConnectedError();\n\n      try {\n        const message = bs58.encode(transaction.serializeMessage());\n        const {\n          msg,\n          data\n        } = await wallet.signTransaction(message);\n        if (!data.publicKey || !data.signature) throw new WalletSignTransactionError(msg);\n        const publicKey = new PublicKey(data.publicKey);\n        const signature = bs58.decode(data.signature);\n        transaction.addSignature(publicKey, signature);\n        return transaction;\n      } catch (error) {\n        if (error instanceof WalletError) throw error;\n        throw new WalletSignTransactionError(error?.message, error);\n      }\n    } catch (error) {\n      this.emit('error', error);\n      throw error;\n    }\n  }\n\n  async signAllTransactions(transactions) {\n    try {\n      const wallet = this._wallet;\n      if (!wallet) throw new WalletNotConnectedError();\n\n      try {\n        const messages = transactions.map(transaction => bs58.encode(transaction.serializeMessage()));\n        const {\n          msg,\n          data\n        } = await wallet.signAllTransactions(messages);\n        const length = transactions.length;\n        if (!data.publicKey || data.signatures?.length !== length) throw new WalletSignTransactionError(msg);\n        const publicKey = new PublicKey(data.publicKey);\n\n        for (let i = 0; i < length; i++) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          transactions[i].addSignature(publicKey, bs58.decode(data.signatures[i]));\n        }\n\n        return transactions;\n      } catch (error) {\n        if (error instanceof WalletError) throw error;\n        throw new WalletSignTransactionError(error?.message, error);\n      }\n    } catch (error) {\n      this.emit('error', error);\n      throw error;\n    }\n  }\n\n  async signMessage(message) {\n    try {\n      const wallet = this._wallet;\n      if (!wallet) throw new WalletNotConnectedError();\n\n      try {\n        const response = await wallet.signMessage(message);\n        return bs58.decode(response.data.signature);\n      } catch (error) {\n        throw new WalletSignMessageError(error?.message, error);\n      }\n    } catch (error) {\n      this.emit('error', error);\n      throw error;\n    }\n  }\n\n} //# sourceMappingURL=adapter.js.map","map":null,"metadata":{},"sourceType":"module"}